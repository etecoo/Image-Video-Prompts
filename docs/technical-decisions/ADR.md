# アーキテクチャ決定記録（ADR）

## YAML形式の柔軟な対応 (2025-02-08)

### 状況
- YAMLファイルが異なる形式（midjourney-prompts形式とimages形式）で出力される
- プロンプト抽出ロジックが特定の形式にのみ対応していた
- 形式の違いによりプロンプト抽出が失敗する問題が発生

### 決定
1. 複数のYAML形式に対応する柔軟な抽出ロジックを実装
   - midjourney-prompts形式を優先的に処理
   - images形式をフォールバックとして使用
   - プロンプトセクションの明確な境界判定

2. エラーハンドリングとデバッグ機能の強化
   - 詳細なデバッグ情報の出力
   - データ構造の検証機能
   - エラー発生時の適切なフォールバック

### 結果
- 異なるYAML形式に対して安定した処理が可能に
- デバッグ情報の充実により問題解決が容易に
- 将来の形式変更にも柔軟に対応可能

### 教訓
- データ形式の多様性を考慮した設計の重要性
- 適切なエラーハンドリングとデバッグ情報の必要性
- 段階的な処理（優先順位付き）の有効性

# アーキテクチャ決定記録（ADR）

## ADR-001: フロントエンドフレームワークとしてReactを採用

### 状態
- 決定日: 2025-02-01
- ステータス: 承認済み
- デシジョンメーカー: プロジェクトチーム

### コンテキスト
プロンプト編集・変換のWebアプリケーションを開発するにあたり、フロントエンドフレームワークの選定が必要。

### 検討された選択肢
1. React
   - 広範なエコシステム
   - 豊富なコンポーネントライブラリ
   - 大規模なコミュニティ
   
2. Vue.js
   - 学習曲線が緩やか
   - 直感的なテンプレート構文
   - 公式ツールの充実

3. Angular
   - フルスタックフレームワーク
   - TypeScriptネイティブ
   - 強力なCLIツール

### 決定
Reactを採用する。

### 理由
1. コンポーネントベースの開発が容易
2. Virtual DOMによる効率的な更新
3. 豊富なサードパーティライブラリ
4. 大規模なコミュニティサポート
5. YAMLエディタコンポーネントの利用可能性

### 影響
- 開発チームはReactの学習が必要
- Create React Appを使用した初期設定が可能
- Material-UIなどのUIライブラリが利用可能

## ADR-002: バックエンドフレームワークとしてFlaskを採用

### 状態
- 決定日: 2025-02-01
- ステータス: 承認済み
- デシジョンメーカー: プロジェクトチーム

### コンテキスト
プロンプト変換APIを提供するバックエンドフレームワークの選定が必要。

### 検討された選択肢
1. Flask
   - 軽量
   - 柔軟な構成
   - 学習曲線が緩やか

2. Django
   - フルスタック
   - 管理画面付き
   - ORM搭載

3. FastAPI
   - 非同期サポート
   - OpenAPI自動生成
   - 型ヒント活用

### 決定
Flaskを採用する。

### 理由
1. プロジェクトの規模に適した軽量さ
2. シンプルなAPIエンドポイント実装
3. 必要最小限の機能セット
4. PyYAMLとの簡単な統合
5. デプロイの容易さ

### 影響
- 認証やORMは必要に応じて追加実装
- ルーティングとエラーハンドリングの明示的な実装が必要
- マイクロサービスアーキテクチャへの適合性

## ADR-003: プロンプト定義フォーマットとしてYAMLを採用

### 状態
- 決定日: 2025-02-01
- ステータス: 承認済み
- デシジョンメーカー: プロジェクトチーム

### コンテキスト
異なるAIモデル間でプロンプトを変換・管理するためのフォーマットが必要。

### 検討された選択肢
1. YAML
   - 人間可読性が高い
   - 階層構造の表現が容易
   - 多くの言語でサポート

2. JSON
   - 標準的なデータ形式
   - パース速度が速い
   - 厳格な構文

3. XML
   - 詳細なスキーマ定義
   - 豊富な検証機能
   - 広範な業界標準

### 決定
YAMLを採用する。

### 理由
1. プロンプトの階層構造表現に適している
2. 人間による読み書きが容易
3. コメント機能の存在
4. Python（PyYAML）とJavaScript（js-yaml）の両方で扱いやすい
5. 設定ファイルとしての一般的な使用実績

### 影響
- フロントエンド・バックエンド両方でYAMLパーサーの実装が必要
- プロンプトテンプレートの構造化が容易
- バージョン管理システムでの差分確認が容易